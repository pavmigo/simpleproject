{"version":3,"file":"praphql.js","sources":["../src/components/provider.js","../src/components/query.js","../src/components/mutation.js","../node_modules/is-plain-obj/index.js","../node_modules/merge-options/index.js","../src/modules/client.js"],"sourcesContent":["export default function Provider ({ client }) {\n  this.getChildContext = () => ({ client })\n}\n\nProvider.prototype.render = props => props.children[0]\n","import { Component } from 'preact'\n\n// TODO: If key is updated, remove/add listener\n\nexport default class Query extends Component {\n  constructor () {\n    super()\n    this.state = {\n      loading: false,\n      loaded: false,\n      data: null\n    }\n  }\n\n  componentWillMount () {\n    const { query, variables, cacheKey } = this.props\n    const { client } = this.context\n\n    if (query && client) {\n      this.setState({ loading: true })\n\n      client.query(query, variables, cacheKey)\n        .then(data => {\n          this.setState({ data, loading: false, loaded: true })\n        })\n    }\n\n    if (cacheKey && client) {\n      client.listenTo(cacheKey, data => {\n        this.setState({ data })\n      })\n    }\n  }\n\n  render ({ children }, state) {\n    return children[0](state)\n  }\n}\n","import { Component } from 'preact'\n\nexport default class Mutation extends Component {\n  constructor () {\n    super()\n    this.state = {\n      loading: false,\n      loaded: false,\n      data: null\n    }\n    this._mutate = this.mutate.bind(this)\n  }\n\n  mutate () {\n    const { mutation, variables, updateCache, appendCache } = this.props\n    const { client } = this.context\n\n    if (mutation && client) {\n      this.setState({ loading: true })\n\n      client.mutate(mutation, variables, { updateCache, appendCache })\n        .then(data => {\n          this.setState({ data, loading: false, loaded: true })\n        })\n    }\n  }\n\n  render ({ children }, state) {\n    return children[0](this._mutate, state)\n  }\n}\n","'use strict';\nvar toString = Object.prototype.toString;\n\nmodule.exports = function (x) {\n\tvar prototype;\n\treturn toString.call(x) === '[object Object]' && (prototype = Object.getPrototypeOf(x), prototype === null || prototype === Object.getPrototypeOf({}));\n};\n","'use strict';\nconst isOptionObject = require('is-plain-obj');\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\nconst propIsEnumerable = Object.propertyIsEnumerable;\nconst defineProperty = (obj, name, value) => Object.defineProperty(obj, name, {\n\tvalue,\n\twritable: true,\n\tenumerable: true,\n\tconfigurable: true\n});\n\nconst globalThis = this;\nconst defaultMergeOpts = {\n\tconcatArrays: false\n};\n\nconst getEnumerableOwnPropertyKeys = value => {\n\tconst keys = [];\n\n\tfor (const key in value) {\n\t\tif (hasOwnProperty.call(value, key)) {\n\t\t\tkeys.push(key);\n\t\t}\n\t}\n\n\t/* istanbul ignore else  */\n\tif (Object.getOwnPropertySymbols) {\n\t\tconst symbols = Object.getOwnPropertySymbols(value);\n\n\t\tfor (let i = 0; i < symbols.length; i++) {\n\t\t\tif (propIsEnumerable.call(value, symbols[i])) {\n\t\t\t\tkeys.push(symbols[i]);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn keys;\n};\n\nfunction clone(value) {\n\tif (Array.isArray(value)) {\n\t\treturn cloneArray(value);\n\t}\n\n\tif (isOptionObject(value)) {\n\t\treturn cloneOptionObject(value);\n\t}\n\n\treturn value;\n}\n\nfunction cloneArray(array) {\n\tconst result = array.slice(0, 0);\n\n\tgetEnumerableOwnPropertyKeys(array).forEach(key => {\n\t\tdefineProperty(result, key, clone(array[key]));\n\t});\n\n\treturn result;\n}\n\nfunction cloneOptionObject(obj) {\n\tconst result = Object.getPrototypeOf(obj) === null ? Object.create(null) : {};\n\n\tgetEnumerableOwnPropertyKeys(obj).forEach(key => {\n\t\tdefineProperty(result, key, clone(obj[key]));\n\t});\n\n\treturn result;\n}\n\n/**\n * @param merged {already cloned}\n * @return {cloned Object}\n */\nconst mergeKeys = (merged, source, keys, mergeOpts) => {\n\tkeys.forEach(key => {\n\t\t// Do not recurse into prototype chain of merged\n\t\tif (key in merged && merged[key] !== Object.getPrototypeOf(merged)) {\n\t\t\tdefineProperty(merged, key, merge(merged[key], source[key], mergeOpts));\n\t\t} else {\n\t\t\tdefineProperty(merged, key, clone(source[key]));\n\t\t}\n\t});\n\n\treturn merged;\n};\n\n/**\n * @param merged {already cloned}\n * @return {cloned Object}\n *\n * see [Array.prototype.concat ( ...arguments )](http://www.ecma-international.org/ecma-262/6.0/#sec-array.prototype.concat)\n */\nconst concatArrays = (merged, source, mergeOpts) => {\n\tlet result = merged.slice(0, 0);\n\tlet resultIndex = 0;\n\n\t[merged, source].forEach(array => {\n\t\tconst indices = [];\n\n\t\t// `result.concat(array)` with cloning\n\t\tfor (let k = 0; k < array.length; k++) {\n\t\t\tif (!hasOwnProperty.call(array, k)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tindices.push(String(k));\n\n\t\t\tif (array === merged) {\n\t\t\t\t// Already cloned\n\t\t\t\tdefineProperty(result, resultIndex++, array[k]);\n\t\t\t} else {\n\t\t\t\tdefineProperty(result, resultIndex++, clone(array[k]));\n\t\t\t}\n\t\t}\n\n\t\t// Merge non-index keys\n\t\tresult = mergeKeys(result, array, getEnumerableOwnPropertyKeys(array).filter(key => {\n\t\t\treturn indices.indexOf(key) === -1;\n\t\t}), mergeOpts);\n\t});\n\n\treturn result;\n};\n\n/**\n * @param merged {already cloned}\n * @return {cloned Object}\n */\nfunction merge(merged, source, mergeOpts) {\n\tif (mergeOpts.concatArrays && Array.isArray(merged) && Array.isArray(source)) {\n\t\treturn concatArrays(merged, source, mergeOpts);\n\t}\n\n\tif (!isOptionObject(source) || !isOptionObject(merged)) {\n\t\treturn clone(source);\n\t}\n\n\treturn mergeKeys(merged, source, getEnumerableOwnPropertyKeys(source), mergeOpts);\n}\n\nmodule.exports = function () {\n\tconst mergeOpts = merge(clone(defaultMergeOpts), (this !== globalThis && this) || {}, defaultMergeOpts);\n\tlet merged = {foobar: {}};\n\n\tfor (let i = 0; i < arguments.length; i++) {\n\t\tconst option = arguments[i];\n\n\t\tif (option === undefined) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!isOptionObject(option)) {\n\t\t\tthrow new TypeError('`' + option + '` is not an Option Object');\n\t\t}\n\n\t\tmerged = merge(merged, {foobar: option}, mergeOpts);\n\t}\n\n\treturn merged.foobar;\n};\n","import merge from 'merge-options'\n\nexport default ({ url }) => {\n  const cache = {}\n  const listeners = {}\n\n  const getCached = (key) => {\n    if (!key) return null\n    return cache[key]\n  }\n\n  const emit = (key) => {\n    if (listeners[key]) {\n      listeners[key].forEach(l => l(cache[key]))\n    }\n  }\n\n  const storeInCache = (key) => (data) => {\n    if (!key) return data\n\n    const cached = cache[key] || {}\n    const obj = merge(cached, data)\n    cache[key] = obj\n\n    emit(key)\n\n    return obj\n  }\n\n  const appendToCache = (key) => (data) => {\n    if (!key) return data\n\n    Object.keys(data).forEach(k => {\n      if (!cache[key][k]) cache[key][k] = []\n\n      cache[key][k].push(data[k])\n    })\n\n    emit(key)\n\n    return data\n  }\n\n  return {\n    query: (query, variables = {}, cacheKey) => {\n      const cached = getCached(cacheKey)\n\n      if (cached) return Promise.resolve(cached)\n\n      const body = JSON.stringify({\n        query,\n        variables\n      })\n\n      return fetch(url, {\n        body,\n        headers: { 'Content-Type': 'application/json' },\n        method: 'POST'\n      })\n        .then(r => r.json())\n        .then(r => r.data)\n        .then(storeInCache(cacheKey))\n    },\n\n    mutate: (query, variables = {}, { updateCache, appendCache }) => {\n      const body = JSON.stringify({\n        query,\n        variables\n      })\n\n      return fetch(url, {\n        body,\n        headers: { 'Content-Type': 'application/json' },\n        method: 'POST'\n      })\n        .then(r => r.json())\n        .then(r => r.data)\n        .then(\n          updateCache ? storeInCache(updateCache) : d => d\n        )\n        .then(\n          appendCache ? appendToCache(appendCache) : d => d\n        )\n    },\n\n    listenTo: (cacheKey, cb) => {\n      if (!listeners[cacheKey]) listeners[cacheKey] = []\n      listeners[cacheKey].push(cb)\n    },\n\n    clearCache: () => {\n      Object.keys(listeners).forEach(key => {\n        cache[key] = null\n        delete cache[key]\n        emit(key)\n      })\n    }\n  }\n}\n"],"names":["Provider","ref","client","this","getChildContext","prototype","render","props","children","Query","super","state","loading","loaded","data","componentWillMount","query","variables","cacheKey","context","setState","then","listenTo","Component","Mutation","_mutate","mutate","bind","mutation","updateCache","appendCache","toString","Object","x","call","getPrototypeOf","hasOwnProperty","propIsEnumerable","propertyIsEnumerable","defineProperty","obj","name","value","writable","enumerable","configurable","globalThis","defaultMergeOpts","concatArrays","getEnumerableOwnPropertyKeys","keys","key","push","getOwnPropertySymbols","symbols","i","length","clone","Array","isArray","array","result","slice","forEach","cloneArray","isOptionObject","create","cloneOptionObject","mergeKeys","merged","source","mergeOpts","merge","resultIndex","indices","k","String","filter","indexOf","module","foobar","arguments","option","undefined","TypeError","url","cache","listeners","emit","l","storeInCache","const","cached","Promise","resolve","body","JSON","stringify","fetch","headers","Content-Type","method","r","json","d","cb","clearCache"],"mappings":"wBAAe,SAASA,EAAUC,OAAEC,WAClCC,KAAKC,yCAA2BF,IAGlCF,EAASK,UAAUC,gBAASC,UAASA,EAAMC,SAAS,ICApD,IAAqBC,cACnB,aACEC,aACAP,KAAKQ,OACHC,SAAS,EACTC,QAAQ,EACRC,KAAM,sGAIVC,2CACyCZ,KAAKI,MAApCS,UAAOC,cAAWC,aAClBhB,EAAWC,KAAKgB,eAEpBH,GAASd,IACXC,KAAKiB,UAAWR,SAAS,IAEzBV,EAAOc,MAAMA,EAAOC,EAAWC,GAC5BG,cAAKP,GACJX,EAAKiB,eAAWN,EAAMF,SAAS,EAAOC,QAAQ,OAIhDK,GAAYhB,GACdA,EAAOoB,SAASJ,WAAUJ,GACxBX,EAAKiB,eAAWN,mBAKtBR,gBAAQL,EAAcU,GACpB,kBAAgB,GAAGA,OA/BYY,aCFdC,cACnB,aACEd,aACAP,KAAKQ,OACHC,SAAS,EACTC,QAAQ,EACRC,KAAM,MAERX,KAAKsB,QAAUtB,KAAKuB,OAAOC,KAAKxB,sGAGlCuB,+BAC4DvB,KAAKI,MAAvDqB,aAAUX,cAAWY,gBAAaC,gBAClC5B,EAAWC,KAAKgB,eAEpBS,GAAY1B,IACdC,KAAKiB,UAAWR,SAAS,IAEzBV,EAAOwB,OAAOE,EAAUX,eAAaY,cAAaC,IAC/CT,cAAKP,GACJX,EAAKiB,eAAWN,EAAMF,SAAS,EAAOC,QAAQ,oBAKtDP,gBAAQL,EAAcU,GACpB,kBAAgB,GAAGR,KAAKsB,QAASd,OA1BCY,oHCDtC,MAAIQ,EAAWC,OAAO3B,UAAU0B,WAEf,SAAUE,GAC1B,IAAI5B,EACJ,MAA4B,oBAArB0B,EAASG,KAAKD,KAAiF,QAApD5B,EAAY2B,OAAOG,eAAeF,KAA0B5B,IAAc2B,OAAOG,oCCLpI,MAGMC,EAAiBJ,OAAO3B,UAAU+B,eAClCC,EAAmBL,OAAOM,qBAC1BC,EAAiB,CAACC,EAAKC,EAAMC,IAAUV,OAAOO,eAAeC,EAAKC,GACvEC,MAAAA,EACAC,UAAU,EACVC,YAAY,EACZC,cAAc,IAGTC,EAAa3C,EACb4C,GACLC,cAAc,GAGTC,EAA+BP,IACpC,MAAMQ,KAEN,IAAK,MAAMC,KAAOT,EACbN,EAAeF,KAAKQ,EAAOS,IAC9BD,EAAKE,KAAKD,GAKZ,GAAInB,OAAOqB,sBAAuB,CACjC,MAAMC,EAAUtB,OAAOqB,sBAAsBX,GAE7C,IAAK,IAAIa,EAAI,EAAGA,EAAID,EAAQE,OAAQD,IAC/BlB,EAAiBH,KAAKQ,EAAOY,EAAQC,KACxCL,EAAKE,KAAKE,EAAQC,IAKrB,OAAOL,GAGR,SAASO,EAAMf,GACd,OAAIgB,MAAMC,QAAQjB,GAWnB,SAAoBkB,GACnB,MAAMC,EAASD,EAAME,MAAM,EAAG,GAM9B,OAJAb,EAA6BW,GAAOG,QAAQZ,IAC3CZ,EAAesB,EAAQV,EAAKM,EAAMG,EAAMT,OAGlCU,EAjBCG,CAAWtB,GAGfuB,EAAevB,GAiBpB,SAA2BF,GAC1B,MAAMqB,EAAwC,OAA/B7B,OAAOG,eAAeK,GAAgBR,OAAOkC,OAAO,SAMnE,OAJAjB,EAA6BT,GAAKuB,QAAQZ,IACzCZ,EAAesB,EAAQV,EAAKM,EAAMjB,EAAIW,OAGhCU,EAvBCM,CAAkBzB,GAGnBA,EA2BR,MAAM0B,EAAY,CAACC,EAAQC,EAAQpB,EAAMqB,KACxCrB,EAAKa,QAAQZ,IAERA,KAAOkB,GAAUA,EAAOlB,KAASnB,OAAOG,eAAekC,GAC1D9B,EAAe8B,EAAQlB,EAAKqB,EAAMH,EAAOlB,GAAMmB,EAAOnB,GAAMoB,IAE5DhC,EAAe8B,EAAQlB,EAAKM,EAAMa,EAAOnB,OAIpCkB,GASFrB,EAAe,CAACqB,EAAQC,EAAQC,KACrC,IAAIV,EAASQ,EAAOP,MAAM,EAAG,GACzBW,EAAc,EA2BlB,OAzBCJ,EAAQC,GAAQP,QAAQH,IACxB,MAAMc,KAGN,IAAK,IAAIC,EAAI,EAAGA,EAAIf,EAAMJ,OAAQmB,IAC5BvC,EAAeF,KAAK0B,EAAOe,KAIhCD,EAAQtB,KAAKwB,OAAOD,IAInBpC,EAAesB,EAAQY,IAFpBb,IAAUS,EAEyBT,EAAMe,GAENlB,EAAMG,EAAMe,MAKpDd,EAASO,EAAUP,EAAQD,EAAOX,EAA6BW,GAAOiB,OAAO1B,IAC3C,IAA1BuB,EAAQI,QAAQ3B,IACpBoB,KAGEV,GAOR,SAASW,EAAMH,EAAQC,EAAQC,GAC9B,OAAIA,EAAUvB,cAAgBU,MAAMC,QAAQU,IAAWX,MAAMC,QAAQW,GAC7DtB,EAAaqB,EAAQC,EAAQC,GAGhCN,EAAeK,IAAYL,EAAeI,GAIxCD,EAAUC,EAAQC,EAAQrB,EAA6BqB,GAASC,GAH/Dd,EAAMa,GAMfS,UAAiB,WAChB,MAAMR,EAAYC,EAAMf,EAAMV,GAAoB5C,OAAS2C,GAAc3C,SAAa4C,GACtF,IAAIsB,GAAUW,WAEd,IAAK,IAAIzB,EAAI,EAAGA,EAAI0B,UAAUzB,OAAQD,IAAK,CAC1C,MAAM2B,EAASD,UAAU1B,GAEzB,QAAe4B,IAAXD,EAAJ,CAIA,IAAKjB,EAAeiB,GACnB,MAAM,IAAIE,UAAU,IAAMF,EAAS,6BAGpCb,EAASG,EAAMH,GAASW,OAAQE,GAASX,IAG1C,OAAOF,EAAOW,4HC/JC/E,OAAEoF,QACVC,KACAC,KAOAC,WAAQrC,GACRoC,EAAUpC,IACZoC,EAAUpC,GAAKY,iBAAQ0B,UAAKA,EAAEH,EAAMnC,OAIlCuC,WAAgBvC,mBAASrC,GAC7B,IAAKqC,EAAK,OAAOrC,EAEjB6E,IACMnD,EAAMgC,EADGc,EAAMnC,OACKrC,GAK1B,OAJAwE,EAAMnC,GAAOX,EAEbgD,EAAKrC,GAEEX,IAiBT,OACExB,eAAQA,EAAOC,EAAgBC,sBAC7ByE,IAvCexC,EAuCTyC,GAvCSzC,EAuCUjC,GArCpBoE,EAAMnC,GADI,KAwCf,GAAIyC,EAAQ,OAAOC,QAAQC,QAAQF,GAEnCD,IAAMI,EAAOC,KAAKC,iBAChBjF,YACAC,IAGF,OAAOiF,MAAMb,QACXU,EACAI,SAAWC,eAAgB,oBAC3BC,OAAQ,SAEPhF,cAAKiF,UAAKA,EAAEC,SACZlF,cAAKiF,UAAKA,EAAExF,OACZO,KAAKqE,EAAaxE,KAGvBQ,gBAASV,EAAOC,EAAgBhB,0BAnCXkD,EAmCatB,gBAAaC,gBACvCiE,EAAOC,KAAKC,iBAChBjF,YACAC,IAGF,OAAOiF,MAAMb,QACXU,EACAI,SAAWC,eAAgB,oBAC3BC,OAAQ,SAEPhF,cAAKiF,UAAKA,EAAEC,SACZlF,cAAKiF,UAAKA,EAAExF,OACZO,KACCQ,EAAc6D,EAAa7D,YAAe2E,UAAKA,IAEhDnF,KACCS,GApDeqB,EAoDarB,WApDJhB,GAC9B,OAAKqC,GAELnB,OAAOkB,KAAKpC,GAAMiD,iBAAQY,GACnBW,EAAMnC,GAAKwB,KAAIW,EAAMnC,GAAKwB,OAE/BW,EAAMnC,GAAKwB,GAAGvB,KAAKtC,EAAK6D,MAG1Ba,EAAKrC,GAEErC,GAVUA,aAmDgC0F,UAAKA,KAItDlF,kBAAWJ,EAAUuF,GACdlB,EAAUrE,KAAWqE,EAAUrE,OACpCqE,EAAUrE,GAAUkC,KAAKqD,IAG3BC,sBACE1E,OAAOkB,KAAKqC,GAAWxB,iBAAQZ,GAC7BmC,EAAMnC,GAAO,YACNmC,EAAMnC,GACbqC,EAAKrC"}